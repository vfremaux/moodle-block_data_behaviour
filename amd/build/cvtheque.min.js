/**
 * Javascript controller for controlling the sections.
 *
 * @module     block_data_behaviour/cvtheque_control
 * @package    block_data_behaviour
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_data_behaviour/cvtheque",["jquery","core/log","core/config","block_data_cart/datacart"],(function($,log,cfg,datacart){var cvtheque={courseid:0,dataid:0,blockid:0,recordid:0,init:function(params){var isview;if(log.debug("AMD Cvtheque start init !"),cvtheque.courseid=params.courseid,cvtheque.dataid=params.dataid,cvtheque.recordid=params.recordid,0!==$(".cvthequetemplate").length){if(isview=$(".cvthequetemplate.view").length>0,$(".cvthequetemplate.edit").length>0){if(0===parseInt($('INPUT[name="rid"]').val())){var profileurl=cfg.wwwroot+"/blocks/data_behaviour/ajax/service.php";profileurl+="?what=getuserinfo",profileurl+="&courseid="+cvtheque.courseid,profileurl+="&dataid="+cvtheque.dataid,$.get(profileurl,(function(data){$("#cv_nom INPUT").val(data.cv_nom),$("#cv_prenom INPUT").val(data.cv_prenom),$("#cv_ville INPUT").val(data.cv_ville),$("#cv_tel1 INPUT").val(data.cv_tel1),$("#cv_tel2 INPUT").val(data.cv_tel2),$("#cv_mail INPUT").val(data.cv_mail),$("#cv_adresse INPUT").val(data.cv_adresse)}),"json")}$(".delete-fieldset div.btn").addClass("dimmed"),$(".data-fs-master").on("change",".mod-data-input",[],this.set_fieldset_controls),$(".data-fs-master .mod-data-input").trigger("change"),$('.cvthequetemplate.edit select[multiple="multiple"]').attr("size",8);let publishedstate=$('#cv_state-value input[value*="Pub"]').is(":checked");publishedstate?$("#cv_state-value").addClass("published"):(publishedstate||$('#cv_state-value input[value*="Brou"]').prop("checked",!0),$("#cv_state-value").addClass("draft")),$('#cv_state-value input[value*="Pub"]').bind("click",this.publish),$('#cv_state-value input[value*="Brou"]').bind("click",this.unpublish),log.debug("AMD Cvtheque Initialized for editing !")}isview&&(this.check_all_fieldsets(),$("#id-add-to-cart").on("click",this.add_to_data_cart),$("#id-add-to-cart").attr("data-recordid",cvtheque.recordid),$("#id-add-to-cart").attr("data-dataid",cvtheque.dataid),log.debug("AMD Cvtheque Initialized for viewing "+cvtheque.dataid+"/"+cvtheque.recordid+" !"))}else log.debug("AMD Cvtheque not found in DOM !")},check_all_fieldsets:function(){var fieldsetelm,fselm;$(".data-fs-master").each((function(){""!=$(this).html()&&(fieldsetelm=$(this).closest(".multiple-fieldset"),fselm=fieldsetelm.attr("data-fs"),log.debug('Hiding empty signal on fieldset[data-fs="'+fselm+'"][data-fsix="0"]'),$('fieldset[data-fs="'+fselm+'"][data-fsix="0"]').addClass("set-hidden"),fieldsetelm.removeClass("set-hidden"))}))},set_fieldset_controls:function(e){var that,fieldsetelm,fselm,fsix,fieldsetinputs,fieldsetselects,fieldsettextareas,masterinput,isfile,isempty,filehiddenfieldelm;if(e.stopPropagation(),e.preventDefault(),that=$(this),log.debug("AMD Cvtheque Setting "+that.attr("id")+" initial state !"),fieldsetelm=that.closest(".multiple-fieldset"),fieldsetinputs=$("#"+fieldsetelm.attr("id")+" :not(.template-token.data-fs-master) INPUT"),fieldsetselects=$("#"+fieldsetelm.attr("id")+" :not(.template-token.data-fs-master) SELECT"),fieldsettextareas=$("#"+fieldsetelm.attr("id")+" :not(.template-token.data-fs-master) TEXTAREA"),masterinput=$("#"+fieldsetelm.attr("id")+" .template-token.data-fs-master INPUT"),fselm=fieldsetelm.attr("data-fs"),fsix=fieldsetelm.attr("data-fsix"),log.debug("AMD Cvtheque Setting : Seeing val '"+that.val()+"' for "+fselm+":"+fsix+" !"),isfile=that.children(".filemanager").length>0){log.debug("AMD Cvtheque : isfile ? "+isfile),filehiddenfieldelm=fieldsetelm.find('input[type="hidden"]').first();var url=cfg.wwwroot+"/blocks/data_behaviour/ajax/service.php";url+="?what=checkfilearea",url+="&filearea=draft&itemid="+filehiddenfieldelm.val(),$.ajax(url,{success:function(result){isempty=result.isempty},async:!1,dataType:"json"}),log.debug("AMD Cvtheque : isempty ? "+isempty)}!isfile&&(""===that.val()||void 0===that.val())||isfile&&isempty?(cvtheque.disable_add_one_more(fselm,parseInt(fsix)+1),fieldsetinputs.prop("disabled",!0),fieldsetselects.prop("disabled",!0),fieldsettextareas.prop("disabled",!0),masterinput.prop("disabled",null),cvtheque.disable_delete(fselm,fsix)):($('fieldset[data-fs="'+fselm+'"][data-fsix="'+fsix+'"]').removeClass("set-hidden"),cvtheque.enable_add_one_more(fselm,parseInt(fsix)+1),cvtheque.disable_add_one_more(fselm,fsix),fieldsetinputs.prop("disabled",null),fieldsetselects.prop("disabled",null),fieldsettextareas.prop("disabled",null),cvtheque.enable_delete(fselm,fsix))},enable_add_one_more:function(fselm,fsix){log.debug("AMD Cvtheque Enabling add one more : "+fselm+":"+fsix+" !"),$('.add-more[data-fs="'+fselm+'"][data-fsix="'+fsix+'"] div.btn').removeClass("dimmed"),$('.add-more[data-fs="'+fselm+'"][data-fsix="'+fsix+'"]').bind("click",cvtheque.add_one_more)},disable_add_one_more:function(fselm,fsix){log.debug("AMD Cvtheque Disabling add one more : "+fselm+":"+fsix+" !"),$('.add-more[data-fs="'+fselm+'"][data-fsix="'+fsix+'"] div.btn').addClass("dimmed"),$('.add-more[data-fs="'+fselm+'"][data-fsix="'+fsix+'"]').unbind("click",cvtheque.add_one_more)},enable_delete:function(fselm,fsix){log.debug("AMD Cvtheque Enabling delete : "+fselm+":"+fsix+" !"),$('.delete-fieldset[data-fs="'+fselm+'"][data-fsix="'+fsix+'"] div.btn').removeClass("dimmed"),$('.delete-fieldset[data-fs="'+fselm+'"][data-fsix="'+fsix+'"]').bind("click",cvtheque.delete_fieldset)},disable_delete:function(fselm,fsix){log.debug("AMD Cvtheque Disabling delete : "+fselm+":"+fsix+" !"),$('.delete-fieldset[data-fs="'+fselm+'"][data-fsix="'+fsix+'"] div.btn').addClass("dimmed"),$('.delete-fieldset[data-fs="'+fselm+'"][data-fsix="'+fsix+'"]').unbind("click",cvtheque.delete_fieldset)},add_one_more:function(e){var that,fselm,fsix,prevfsix,fieldsetelm,fieldsetinputs,fieldsetselects,fieldsettextareas;e.stopPropagation(),e.preventDefault(),fieldsetelm=(that=$(this)).closest(".multiple-fieldset"),fieldsetinputs=$("#"+fieldsetelm.attr("id")+" :not(.template-token.data-fs-master) INPUT"),fieldsetselects=$("#"+fieldsetelm.attr("id")+" :not(.template-token.data-fs-master) SELECT"),fieldsettextareas=$("#"+fieldsetelm.attr("id")+" :not(.template-token.data-fs-master) TEXTAREA"),fselm=that.attr("data-fs"),fsix=that.attr("data-fsix"),prevfsix=parseInt(fsix)-1,$('.multiple-fieldset[data-fs="'+fselm+'"][data-fsix="'+fsix+'"]').toggleClass("set-hidden"),cvtheque.disable_add_one_more(fselm,prevfsix),fieldsetinputs.prop("disabled",null),fieldsetselects.prop("disabled",null),fieldsettextareas.prop("disabled",null)},delete_fieldset:function(e){var that,fselm,fsix,jqfieldsetelm,loopctl,nextfsix,nextjqfieldset,textareaelm,i;for(e.stopPropagation(),e.preventDefault(),fselm=(that=$(this)).attr("data-fs"),fsix=that.attr("data-fsix"),log.debug("AMD Cvtheque deleting/emptying : "+fselm+":"+fsix+" !"),jqfieldsetelm=that.closest(".multiple-fieldset"),$('input[type="text"]',jqfieldsetelm).val(null),$("textarea",jqfieldsetelm).html(null),$("select",jqfieldsetelm).val(null),$('input[type="checkbox"]',jqfieldsetelm).attr("checked",null),$('input[type="radio"]',jqfieldsetelm).attr("checked",null),void 0!==(textareaelm=$('input[type="textarea"]',jqfieldsetelm).first())&&$("#"+textareaelm.attr("id")+"editable").html(""),nextfsix=0+parseInt(fsix)+1,cvtheque.disable_add_one_more(fselm,nextfsix),cvtheque.disable_delete(fselm,fsix),nextfsix=0+parseInt(fsix)+1,null!=(nextjqfieldset=jqfieldsetelm.next())?loopctl=!0:log.debug("AMD Cvtheque finding no more elements : "+fselm+":"+nextfsix+" !");loopctl;)if(log.debug("AMD Cvtheque processing : "+fselm+":"+nextfsix+" !"),log.debug("AMD Cvtheque previous : "+fselm+":"+jqfieldsetelm.attr("data-fsix")+" !"),null==nextjqfieldset||0==nextjqfieldset.length)log.debug("AMD Cvtheque found "+fselm+":"+(0+parseInt(nextfsix)-1)+" was last one !"),jqfieldsetelm.toggleClass("set-hidden"),$('input[type="text"]',jqfieldsetelm).val(null),$("textarea",jqfieldsetelm).html(null),$("select",jqfieldsetelm).val(null),$('input[type="checkbox"]',jqfieldsetelm).attr("checked",null),$('input[type="radio"]',jqfieldsetelm).attr("checked",null),void 0!==(textareaelm=$('input[type="textarea"]',jqfieldsetelm).first())&&$("#"+textareaelm.attr("id")+"editable").html(""),cvtheque.disable_add_one_more(fselm,nextfsix),cvtheque.disable_delete(fselm,nextfsix-1),cvtheque.enable_add_one_more(fselm,nextfsix-1),loopctl=!1;else{if(log.debug("AMD Cvtheque current : "+fselm+":"+nextjqfieldset.attr("data-fsix")+" !"),nextjqfieldset.hasClass("set-hidden"))log.debug("AMD Cvtheque current was hidden (empty), so hide the previous"),jqfieldsetelm.toggleClass("set-hidden"),$('input[type="text"]',jqfieldsetelm).val(null),$("textarea",jqfieldsetelm).html(null),$("select",jqfieldsetelm).val(null),$('input[type="checkbox"]',jqfieldsetelm).attr("checked",null),$('input[type="radio"]',jqfieldsetelm).prop("checked",null),cvtheque.disable_add_one_more(fselm,nextfsix-1),cvtheque.disable_add_one_more(fselm,nextfsix-2),cvtheque.enable_add_one_more(fselm,nextfsix);else{log.debug("AMD Cvtheque copy to n-1 !");var textinputs=$('input[type="text"]',nextjqfieldset);for(i=0;i<textinputs.length;i++)cvtheque.copy_text(textinputs[i],jqfieldsetelm,nextfsix);var textareas=$("textarea",nextjqfieldset);for(i=0;i<textareas.length;i++)cvtheque.copy_textarea(textareas[i],jqfieldsetelm,nextfsix);var selects=$("select",nextjqfieldset);for(i=0;i<selects.length;i++)cvtheque.copy_select(selects[i],jqfieldsetelm,nextfsix);var checkboxes=$('input[type="checkbox"]',nextjqfieldset);for(i=0;i<checkboxes.length;i++)cvtheque.copy_check(checkboxes[i],jqfieldsetelm,nextfsix);var radios=$('input[type="radio"]',nextjqfieldset);for(i=0;i<radios.length;i++)cvtheque.copy_radio(radios[i],jqfieldsetelm,nextfsix);cvtheque.enable_add_one_more(fselm,nextfsix),cvtheque.enable_delete(fselm,nextfsix-1)}nextfsix=0+parseInt(nextfsix)+1,jqfieldsetelm=nextjqfieldset,nextjqfieldset=$('.multiple-fieldset[data-fs="'+fselm+'"][data-fsix="'+nextfsix+'"]')}},copy_text:function(element,jqfieldsetelm,nextfsix){var tdid=$(element).closest("td").attr("id");log.debug("Selecting value in element name "+$(element).attr("name"));var inputvalue=$(element).val();log.debug("Input value is "+inputvalue);var lastfsix=0+parseInt(nextfsix)-1,lasttdid=(tdid=tdid.replace(/[0-9]+$/,""))+lastfsix,targetinput=$("#"+lasttdid+' input[type="text"]');log.debug("Transfering value '"+inputvalue+"' to element name "+targetinput.attr("name")+" in td of id "+lasttdid),targetinput.val(inputvalue)},copy_textarea:function(element,jqfieldsetelm,nextfsix){var tdid=$(element).closest("td").attr("id");log.debug("Selecting value in element name "+$(element).attr("name"));var inputvalue=$(element).val();log.debug("Input value is "+inputvalue);var lastfsix=0+parseInt(nextfsix)-1;tdid=tdid.replace(/[0-9]+$/,"");var targetinput=$("#"+(tdid+lastfsix)+" textarea");targetinput.val(inputvalue);var targetareaid=targetinput.attr("id");$("#"+targetareaid+"editable").html(inputvalue)},copy_select:function(element,jqfieldsetelm,nextfsix){var td=$(element).closest("td"),tdid=td.attr("id");if(td.hasClass("is-date")){log.debug("Selecting value in element name "+$(element).attr("name"));var component;inputvalue=$(element).val();log.debug("Input value is "+inputvalue),component=$(element).attr("name").match("day$")?"day":$(element).attr("name").match("month$")?"month":"year";lastfsix=0+parseInt(nextfsix)-1;tdid=tdid.replace(/[0-9]+$/,""),$("#"+(tdid+lastfsix)+' select[name$="'+component+'"]').val(inputvalue)}else{log.debug("Selecting value in element name "+$(element).attr("name"));var inputvalue=$(element).val();log.debug("Input value is "+inputvalue);var lastfsix=0+parseInt(nextfsix)-1;tdid=tdid.replace(/[0-9]+$/,""),$("#"+(tdid+lastfsix)+" select").val(inputvalue)}},copy_check:function(element,jqfieldsetelm,nextfsix){var tdid=$(element).closest("td").attr("id");log.debug("Selecting value in element name "+$(element).attr("name"));var inputchecked=$(element).attr("checked"),lastfsix=0+parseInt(nextfsix)-1;tdid=tdid.replace(/[0-9]+$/,""),$("#"+(tdid+lastfsix)+' input[type="checkbox"]').attr("checked",inputchecked)},copy_radio:function(element,jqfieldsetelm,nextfsix){var tdid=$(element).closest("td").attr("id");log.debug("Selecting value in element name "+$(element).attr("name"));var inputchecked=$(element).attr("checked"),lastfsix=0+parseInt(nextfsix)-1;tdid=tdid.replace(/[0-9]+$/,""),$("#"+(tdid+lastfsix)+' input[type="radio"]').prop("checked",inputchecked).trigger("click")},publish:function(e){e.stopPropagation(),e.preventDefault(),$("#cv_state-value").removeClass("draft"),$("#cv_state-value").addClass("published")},unpublish:function(e){e.stopPropagation(),e.preventDefault(),$("#cv_state-value").removeClass("published"),$("#cv_state-value").addClass("draft")},add_to_data_cart:function(e){var recordid;e.stopPropagation(),e.preventDefault(),recordid=$(this).attr("data-recordid"),datacart.add_record(recordid)}};return cvtheque}));

//# sourceMappingURL=cvtheque.min.js.map