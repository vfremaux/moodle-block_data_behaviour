/**
 * Javascript controller for controlling the sections.
 *
 * @module     block_multicourse_navigation/collapse_control
 * @package    block_multicourse_navigation
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_data_behaviour/cvtheque",["jquery","core/log","core/config","block_data_cart/datacart"],(function($,log,cfg,datacart){var cvtheque={courseid:0,dataid:0,blockid:0,recordid:0,init:function(params){var isview;if(log.debug("AMD Cvtheque start init !"),cvtheque.courseid=params.courseid,cvtheque.dataid=params.dataid,cvtheque.recordid=params.recordid,0!==$(".cvthequetemplate").length){if(isview=$(".cvthequetemplate.view").length>0,$(".cvthequetemplate.edit").length>0){if(0===parseInt($('INPUT[name="rid"]').val())){var profileurl=cfg.wwwroot+"/blocks/data_behaviour/ajax/service.php";profileurl+="?what=getuserinfo",profileurl+="&courseid="+cvtheque.courseid,profileurl+="&dataid="+cvtheque.dataid,$.get(profileurl,(function(data){$("#cv_nom INPUT").val(data.cv_nom),$("#cv_prenom INPUT").val(data.cv_prenom),$("#cv_ville INPUT").val(data.cv_ville),$("#cv_tel1 INPUT").val(data.cv_tel1),$("#cv_tel2 INPUT").val(data.cv_tel2),$("#cv_mail INPUT").val(data.cv_mail),$("#cv_adresse INPUT").val(data.cv_adresse)}),"json")}$(".delete-fieldset div.btn").addClass("dimmed"),$(".data-fs-master").on("change",".mod-data-input",[],this.set_fieldset_controls),$(".data-fs-master .mod-data-input").trigger("change"),$('.cvthequetemplate.edit select[multiple="multiple"]').attr("size",8);let publishedstate=$('#cv_state-value input[value*="Pub"]').is(":checked");publishedstate?$("#cv_state-value").addClass("published"):(publishedstate||$('#cv_state-value input[value*="Brou"]').prop("checked",!0),$("#cv_state-value").addClass("draft")),$('#cv_state-value input[value*="Pub"]').bind("click",this.publish),$('#cv_state-value input[value*="Brou"]').bind("click",this.unpublish),log.debug("AMD Cvtheque Initialized for editing !")}isview&&(this.check_all_fieldsets(),$("#id-add-to-cart").on("click",this.add_to_data_cart),$("#id-add-to-cart").attr("data-recordid",cvtheque.recordid),$("#id-add-to-cart").attr("data-dataid",cvtheque.dataid),log.debug("AMD Cvtheque Initialized for viewing "+cvtheque.dataid+"/"+cvtheque.recordid+" !"))}else log.debug("AMD Cvtheque not found in DOM !")},check_all_fieldsets:function(){var fieldsetelm,fselm;$(".data-fs-master").each((function(){""!=$(this).html()&&(fieldsetelm=$(this).closest(".multiple-fieldset"),fselm=fieldsetelm.attr("data-fs"),log.debug('Hiding empty signal on fieldset[data-fs="'+fselm+'"][data-fsix="0"]'),$('fieldset[data-fs="'+fselm+'"][data-fsix="0"]').addClass("set-hidden"),fieldsetelm.removeClass("set-hidden"))}))},set_fieldset_controls:function(e){var that,fieldsetelm,fselm,fsix,fieldsetinputs,fieldsetselects,fieldsettextareas,masterinput,isfile,isempty,filehiddenfieldelm;if(e.stopPropagation(),e.preventDefault(),that=$(this),log.debug("AMD Cvtheque Setting "+that.attr("id")+" initial state !"),fieldsetelm=that.closest(".multiple-fieldset"),fieldsetinputs=$("#"+fieldsetelm.attr("id")+" :not(.template-token.data-fs-master) INPUT"),fieldsetselects=$("#"+fieldsetelm.attr("id")+" :not(.template-token.data-fs-master) SELECT"),fieldsettextareas=$("#"+fieldsetelm.attr("id")+" :not(.template-token.data-fs-master) TEXTAREA"),masterinput=$("#"+fieldsetelm.attr("id")+" .template-token.data-fs-master INPUT"),fselm=fieldsetelm.attr("data-fs"),fsix=fieldsetelm.attr("data-fsix"),log.debug("AMD Cvtheque Setting : Seeing val '"+that.val()+"' for "+fselm+":"+fsix+" !"),isfile=that.children(".filemanager").length>0){log.debug("AMD Cvtheque : isfile ? "+isfile),filehiddenfieldelm=fieldsetelm.find('input[type="hidden"]').first();var url=cfg.wwwroot+"/blocks/data_behaviour/ajax/service.php";url+="?what=checkfilearea",url+="&filearea=draft&itemid="+filehiddenfieldelm.val(),$.ajax(url,{success:function(result){isempty=result.isempty},async:!1,dataType:"json"}),log.debug("AMD Cvtheque : isempty ? "+isempty)}!isfile&&(""===that.val()||void 0===that.val())||isfile&&isempty?(cvtheque.disable_add_one_more(fselm,parseInt(fsix)+1),fieldsetinputs.prop("disabled",!0),fieldsetselects.prop("disabled",!0),fieldsettextareas.prop("disabled",!0),masterinput.prop("disabled",null),cvtheque.disable_delete(fselm,fsix)):($('fieldset[data-fs="'+fselm+'"][data-fsix="'+fsix+'"]').removeClass("set-hidden"),cvtheque.enable_add_one_more(fselm,parseInt(fsix)+1),cvtheque.disable_add_one_more(fselm,fsix),fieldsetinputs.prop("disabled",null),fieldsetselects.prop("disabled",null),fieldsettextareas.prop("disabled",null),cvtheque.enable_delete(fselm,fsix))},enable_add_one_more:function(fselm,fsix){log.debug("AMD Cvtheque Enabling add one more : "+fselm+":"+fsix+" !"),$('.add-more[data-fs="'+fselm+'"][data-fsix="'+fsix+'"] div.btn').removeClass("dimmed"),$('.add-more[data-fs="'+fselm+'"][data-fsix="'+fsix+'"]').bind("click",cvtheque.add_one_more)},disable_add_one_more:function(fselm,fsix){log.debug("AMD Cvtheque Disabling add one more : "+fselm+":"+fsix+" !"),$('.add-more[data-fs="'+fselm+'"][data-fsix="'+fsix+'"] div.btn').addClass("dimmed"),$('.add-more[data-fs="'+fselm+'"][data-fsix="'+fsix+'"]').unbind("click",cvtheque.add_one_more)},enable_delete:function(fselm,fsix){log.debug("AMD Cvtheque Enabling delete : "+fselm+":"+fsix+" !"),$('.delete-fieldset[data-fs="'+fselm+'"][data-fsix="'+fsix+'"] div.btn').removeClass("dimmed"),$('.delete-fieldset[data-fs="'+fselm+'"][data-fsix="'+fsix+'"]').bind("click",cvtheque.delete_fieldset)},disable_delete:function(fselm,fsix){log.debug("AMD Cvtheque Disabling delete : "+fselm+":"+fsix+" !"),$('.delete-fieldset[data-fs="'+fselm+'"][data-fsix="'+fsix+'"] div.btn').addClass("dimmed"),$('.delete-fieldset[data-fs="'+fselm+'"][data-fsix="'+fsix+'"]').unbind("click",cvtheque.delete_fieldset)},add_one_more:function(e){var that,fselm,fsix,prevfsix,fieldsetelm,fieldsetinputs,fieldsetselects,fieldsettextareas;e.stopPropagation(),e.preventDefault(),fieldsetelm=(that=$(this)).closest(".multiple-fieldset"),fieldsetinputs=$("#"+fieldsetelm.attr("id")+" :not(.template-token.data-fs-master) INPUT"),fieldsetselects=$("#"+fieldsetelm.attr("id")+" :not(.template-token.data-fs-master) SELECT"),fieldsettextareas=$("#"+fieldsetelm.attr("id")+" :not(.template-token.data-fs-master) TEXTAREA"),fselm=that.attr("data-fs"),fsix=that.attr("data-fsix"),prevfsix=parseInt(fsix)-1,$('.multiple-fieldset[data-fs="'+fselm+'"][data-fsix="'+fsix+'"]').toggleClass("set-hidden"),cvtheque.disable_add_one_more(fselm,prevfsix),fieldsetinputs.prop("disabled",null),fieldsetselects.prop("disabled",null),fieldsettextareas.prop("disabled",null)},delete_fieldset:function(e){var that,fselm,fsix,jqfieldsetelm,loopctl,nextfsix,nextjqfieldset,textareaelm;for(e.stopPropagation(),e.preventDefault(),fselm=(that=$(this)).attr("data-fs"),fsix=that.attr("data-fsix"),log.debug("AMD Cvtheque deleting/emptying : "+fselm+":"+fsix+" !"),jqfieldsetelm=that.closest(".multiple-fieldset"),$('input[type="text"]',jqfieldsetelm).val(null),$("textarea",jqfieldsetelm).val(null),$('input[type="select"]',jqfieldsetelm).val(null),$('input[type="checkbox"]',jqfieldsetelm).attr("checked",null),$('input[type="radio"]',jqfieldsetelm).attr("checked",null),void 0!==(textareaelm=$('input[type="textarea"]',jqfieldsetelm).first())&&$("#"+textareaelm.attr("id")+"editable").html(""),cvtheque.disable_add_one_more(fselm,fsix),nextfsix=fsix+1,null!=(nextjqfieldset=jqfieldsetelm.next())&&(loopctl=!0);loopctl;)0==nextjqfieldset.length?($('input[type="text"]',jqfieldsetelm).val(null),$("textarea",jqfieldsetelm).val(null),$('input[type="select"]',jqfieldsetelm).val(null),$('input[type="checkbox"]',jqfieldsetelm).attr("checked",null),$('input[type="radio"]',jqfieldsetelm).attr("checked",null),jqfieldsetelm.toggleClass("set-hidden"),void 0!==(textareaelm=$('input[type="textarea"]',jqfieldsetelm).first())&&$("#"+textareaelm.attr("id")+"editable").html(""),cvtheque.enable_add_one_more(fselm,nextfsix-2),loopctl=!1):(nextjqfieldset.hasClass("set-hidden")?(jqfieldsetelm.toggleClass("set-hidden"),cvtheque.enable_add_one_more(fselm,nextfsix-2)):($('input[type="text"]',nextjqfieldset).each(cvtheque.copy_text(jqfieldsetelm,nextfsix)),$("textarea",nextjqfieldset).each(cvtheque.copy_textarea(jqfieldsetelm,nextfsix)),$('input[type="select"]',nextjqfieldset).each(cvtheque.copy_select(jqfieldsetelm,nextfsix)),$('input[type="checkbox"]',nextjqfieldset).each(cvtheque.copy_check(jqfieldsetelm,nextfsix)),$('input[type="radio"]',nextjqfieldset).each(cvtheque.copy_radio(jqfieldsetelm,nextfsix)),jqfieldsetelm.toggleClass("set-hidden"),cvtheque.disable_add_one_more(fselm,fsix)),jqfieldsetelm=nextjqfieldset,nextjqfieldset=$('.multiple-fieldset[data-fs="'+fselm+'"][data-fsix="'+(nextfsix+=1)+'"]'))},copy_text:function(jqfieldsetelm,nextfsix){var inputname=$(this).attr("name"),inputvalue=$(this).val(),lastfsix=nextfsix-1;inputname.replace(/\\d+$/,""),$('input[name="'+(inputname+=lastfsix)+'"]',jqfieldsetelm).val(inputvalue)},copy_textarea:function(jqfieldsetelm,nextfsix){var inputname=$(this).attr("name"),inputvalue=$(this).val(),lastfsix=($(this).attr("id"),nextfsix-1);inputname.replace(/\\d+$/,""),$('textarea[name="'+(inputname+=lastfsix)+'"]',jqfieldsetelm).val(inputvalue);var targetareaid=$('textarea[name="'+inputname+'"]',jqfieldsetelm).first().attr("id");$("#"+targetareaid+"editable").html(inputvalue)},copy_select:function(jqfieldsetelm,nextfsix){var inputname=$(this).attr("name"),inputvalue=$(this).val(),lastfsix=nextfsix-1;inputname.replace(/\\d+$/,""),$('input[name="'+(inputname+=lastfsix)+'"]',jqfieldsetelm).val(inputvalue)},copy_check:function(jqfieldsetelm,nextfsix){var inputname=$(this).attr("name"),inputchecked=$(this).attr("checked"),lastfsix=nextfsix-1;inputname.replace(/\\d+$/,""),$('input[name="'+(inputname+=lastfsix)+'"]',jqfieldsetelm).attr("checked",inputchecked)},copy_radio:function(jqfieldsetelm,nextfsix){var inputname=$(this).attr("name"),inputchecked=$(this).attr("checked"),lastfsix=nextfsix-1;inputname.replace(/\\d+$/,""),$('input[name="'+(inputname+=lastfsix)+'"]',jqfieldsetelm).attr("checked",inputchecked)},publish:function(e){e.stopPropagation(),e.preventDefault(),$("#cv_state-value").removeClass("draft"),$("#cv_state-value").addClass("published")},unpublish:function(e){e.stopPropagation(),e.preventDefault(),$("#cv_state-value").removeClass("published"),$("#cv_state-value").addClass("draft")},add_to_data_cart:function(e){var recordid;e.stopPropagation(),e.preventDefault(),recordid=$(this).attr("data-recordid"),datacart.add_record(recordid)}};return cvtheque}));

//# sourceMappingURL=cvtheque.min.js.map